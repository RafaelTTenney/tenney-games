<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Tower Defence Collection</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        :root {
            --bg: #050505;
            --panel: rgba(20, 20, 20, 0.95);
            --neon-blue: #00F3FF;
            --neon-pink: #FF00FF;
            --neon-green: #00FF00;
            --neon-orange: #FF8800;
        }
        body {
            margin: 0; background: var(--bg); color: #eee;
            font-family: 'Segoe UI', 'Roboto', monospace;
            display: flex; justify-content: center; align-items: center; height: 100vh;
            overflow: hidden; user-select: none;
        }
        #game-wrapper {
            position: relative; width: 800px; height: 600px;
            background: #000; border: 1px solid #333;
            box-shadow: 0 0 60px rgba(0,0,0,0.8);
        }
        canvas { display: block; outline: none; }

        /* OVERLAYS */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(5,5,5,0.95); z-index: 100; backdrop-filter: blur(8px);
        }
        .overlay.active { display: flex; }

        h1 {
            font-size: 3em; margin: 0 0 10px 0; letter-spacing: 6px; text-transform: uppercase;
            background: linear-gradient(90deg, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        /* CARDS */
        .card-container { display: flex; gap: 20px; margin-top: 30px; }
        .card {
            width: 200px; padding: 20px; border: 1px solid #333; background: #111;
            text-align: center; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden;
        }
        .card:hover { transform: translateY(-5px); border-color: #666; }
        .card h2 { font-size: 1.2em; margin-bottom: 5px; letter-spacing: 2px; }
        .card p { font-size: 0.8em; color: #888; line-height: 1.4; }
        .card.c1:hover { border-color: var(--neon-orange); box-shadow: 0 0 20px rgba(255,136,0,0.2); }
        .card.c2:hover { border-color: var(--neon-pink); box-shadow: 0 0 20px rgba(255,0,255,0.2); }
        .card.c3:hover { border-color: var(--neon-blue); box-shadow: 0 0 20px rgba(0,255,255,0.2); }

        /* HUD */
        #hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 60px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            display: none; justify-content: space-between; align-items: center; padding: 0 20px;
            box-sizing: border-box; z-index: 50; pointer-events: none;
        }
        #hud > * { pointer-events: auto; }
        .stats { display: flex; gap: 20px; font-family: monospace; font-size: 1.2em; font-weight: bold; text-shadow: 0 2px 4px #000; }
        
        .btn {
            background: #222; border: 1px solid #444; color: #fff; padding: 8px 16px;
            cursor: pointer; text-transform: uppercase; font-weight: bold; font-size: 0.8em; letter-spacing: 1px;
            transition: 0.2s;
        }
        .btn:hover { background: #333; border-color: #fff; }
        .btn-glow { border-color: var(--neon-green); color: var(--neon-green); }
        .btn-glow:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 15px var(--neon-green); }

        /* CONTROLS BAR */
        #controls {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 90px;
            background: var(--panel); border-top: 1px solid #333;
            display: none; justify-content: center; align-items: center; gap: 10px; z-index: 50;
        }
        .t-btn {
            width: 70px; height: 70px; background: #151515; border: 1px solid #333;
            color: #666; cursor: pointer; display: flex; flex-direction: column;
            align-items: center; justify-content: center; font-size: 0.7em; transition: 0.2s;
        }
        .t-btn:hover { background: #222; color: #fff; border-color: #555; }
        .t-btn.active { border-color: #fff; background: #2a2a2a; color: #fff; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .t-icon { width: 20px; height: 20px; margin-bottom: 5px; border-radius: 2px; }

        /* INSPECTOR */
        #inspector {
            position: absolute; bottom: 100px; right: 20px; width: 200px;
            background: rgba(15,15,15,0.95); border: 1px solid #444; padding: 15px;
            display: none; color: #eee; z-index: 50; box-shadow: 0 5px 20px #000;
        }
        .insp-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.85em; color: #aaa; }
        .insp-val { color: #fff; font-family: monospace; }
        
        /* HELP MODAL */
        #help-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 500px; background: #111; border: 1px solid #444; padding: 30px;
            display: none; z-index: 200; box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        #help-modal h2 { margin-top: 0; color: var(--neon-blue); }
        #help-modal li { margin-bottom: 8px; color: #ccc; font-size: 0.9em; }

        .diff-select { margin-bottom: 20px; display: flex; gap: 10px; }
        .diff-btn { padding: 5px 10px; border: 1px solid #444; background: #000; color: #666; cursor: pointer; }
        .diff-btn.selected { border-color: var(--neon-green); color: var(--neon-green); }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <canvas id="c" width="800" height="600"></canvas>
        
        <div id="menu-screen" class="overlay active">
            <h1>DEFENCE <span style="color:var(--neon-blue)">HUB</span></h1>
            
            <div class="diff-select">
                <button class="diff-btn" onclick="Engine.setDiff(0.8, this)">EASY</button>
                <button class="diff-btn selected" onclick="Engine.setDiff(1.0, this)">NORMAL</button>
                <button class="diff-btn" onclick="Engine.setDiff(1.5, this)">HARD</button>
            </div>

            <div class="card-container">
                <div class="card c1" onclick="Engine.load(1)">
                    <h2 style="color:var(--neon-orange)">VECTOR VALLEY</h2>
                    <p>Fixed Path<br>Retro Arcade Style<br>Fast Paced</p>
                </div>
                <div class="card c2" onclick="Engine.load(2)">
                    <h2 style="color:var(--neon-pink)">NEON CITADEL</h2>
                    <p>Maze Builder<br>High Fidelity<br>Complex AI</p>
                </div>
                <div class="card c3" onclick="Engine.load(3)">
                    <h2 style="color:var(--neon-blue)">SENTINEL GRID</h2>
                    <p>Tactical Tiles<br>Classic Strategy<br>Resource Management</p>
                </div>
            </div>
            
            <a href="experimental.html" style="margin-top:40px; color:#666; text-decoration:none; font-size:0.8em;">EXIT TO SYSTEM</a>
        </div>

        <div id="hud">
            <div class="stats">
                <span style="color:#888">WAVE <span id="ui-wave" style="color:#fff">1</span></span>
                <span style="color:#FFD700">$<span id="ui-money">0</span></span>
                <span style="color:#F55">â™¥ <span id="ui-lives">0</span></span>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn" onclick="Engine.showHelp()">?</button>
                <button class="btn" onclick="Engine.showMenu()">HUB</button>
                <button class="btn btn-glow" onclick="Engine.startWave()">NEXT WAVE</button>
            </div>
        </div>

        <div id="controls"></div>

        <div id="inspector">
            <h3 id="insp-title" style="margin:0 0 10px 0; color:var(--neon-blue);">Tower</h3>
            <div class="insp-row"><span>Damage</span><span class="insp-val" id="i-dmg">0</span></div>
            <div class="insp-row"><span>Range</span><span class="insp-val" id="i-rng">0</span></div>
            <div class="insp-row"><span>Speed</span><span class="insp-val" id="i-spd">0</span></div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <button class="btn" style="flex:1; border-color:var(--neon-blue); color:var(--neon-blue);" onclick="Engine.upgrade()">UPGRADE<br><span id="i-up-cost" style="font-size:0.8em;">$0</span></button>
                <button class="btn" style="flex:1; border-color:#f55; color:#f55;" onclick="Engine.sell()">SELL<br><span id="i-sell-cost" style="font-size:0.8em;">$0</span></button>
            </div>
        </div>

        <div id="help-modal">
            <h2 id="help-title">HOW TO PLAY</h2>
            <ul id="help-list" style="padding-left:20px; line-height:1.6;"></ul>
            <button class="btn" style="width:100%; margin-top:20px;" onclick="document.getElementById('help-modal').style.display='none'">CLOSE</button>
        </div>
        
        <div id="game-over" class="overlay">
            <h1 style="color:#fff">GAME OVER</h1>
            <p id="go-msg" style="color:#aaa; margin-bottom:30px;"></p>
            <button class="btn" style="border-color:#fff; padding:15px 30px;" onclick="Engine.showMenu()">RETURN TO HUB</button>
        </div>
    </div>

    <script src="vector-valley.js"></script>
    <script src="neon-citadel.js"></script>
    <script src="sentinel-grid.js"></script>

    <script>
    const Engine = {
        ctx: document.getElementById('c').getContext('2d', {alpha: false}),
        game: null,
        loopId: null,
        diff: 1.0,

        setDiff: (v, btn) => {
            Engine.diff = v;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        },

        showMenu: () => {
            Engine.stop();
            document.querySelectorAll('.overlay').forEach(o => o.classList.remove('active'));
            document.getElementById('menu-screen').classList.add('active');
            document.getElementById('hud').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('inspector').style.display = 'none';
            document.getElementById('help-modal').style.display = 'none';
        },

        load: (id) => {
            document.querySelectorAll('.overlay').forEach(o => o.classList.remove('active'));
            document.getElementById('hud').style.display = 'flex';
            document.getElementById('controls').style.display = 'flex';
            
            if(id===1) Engine.game = VectorGame;
            if(id===2) Engine.game = NeonGame;
            if(id===3) Engine.game = SentinelGame;

            Engine.game.init(document.getElementById('c'), Engine.diff);
            Engine.buildControls();
            Engine.loop();
        },

        stop: () => {
            if(Engine.loopId) cancelAnimationFrame(Engine.loopId);
            Engine.game = null;
        },

        loop: () => {
            if(!Engine.game) return;
            Engine.game.update();
            Engine.game.draw(Engine.ctx);
            Engine.updateUI();

            if(Engine.game.lives <= 0 && !Engine.game.gameOver) {
                Engine.game.gameOver = true;
                document.getElementById('game-over').classList.add('active');
                document.getElementById('go-msg').innerText = `You reached Wave ${Engine.game.wave}`;
            }
            Engine.loopId = requestAnimationFrame(Engine.loop);
        },

        // --- BRIDGE ---
        startWave: () => Engine.game && Engine.game.startWave(),
        setBuild: (k) => {
            if(Engine.game) {
                Engine.game.setBuild(k);
                document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
                if(k) document.getElementById('btn-'+k).classList.add('active');
                Engine.updateInsp();
            }
        },
        upgrade: () => { Engine.game && Engine.game.upgrade(); Engine.updateInsp(); },
        sell: () => { Engine.game && Engine.game.sell(); Engine.updateInsp(); },
        
        // --- UI ---
        buildControls: () => {
            const div = document.getElementById('controls');
            div.innerHTML = '';
            const conf = Engine.game.conf.towers;
            for(let k in conf) {
                let t = conf[k];
                let b = document.createElement('div');
                b.className = 't-btn';
                b.id = 'btn-'+k;
                b.innerHTML = `<div class="t-icon" style="background:${t.color}; box-shadow:0 0 5px ${t.color}"></div>${t.name}<div style="color:#FFD700; margin-top:2px;">$${t.cost}</div>`;
                b.onclick = () => Engine.setBuild(Engine.game.build===k ? null : k);
                div.appendChild(b);
            }
        },
        
        updateUI: () => {
            if(!Engine.game) return;
            document.getElementById('ui-wave').innerText = Engine.game.wave;
            document.getElementById('ui-money').innerText = Math.floor(Engine.game.money);
            document.getElementById('ui-lives').innerText = Engine.game.lives;
        },

        updateInsp: () => {
            const el = document.getElementById('inspector');
            const s = Engine.game.sel;
            if(!s) { el.style.display = 'none'; return; }
            
            el.style.display = 'block';
            const def = Engine.game.conf.towers[s.type];
            document.getElementById('insp-title').innerText = def.name + (s.lvl>1 ? " MK"+s.lvl : "");
            document.getElementById('insp-title').style.color = def.color;
            document.getElementById('i-dmg').innerText = Math.floor(s.dmg);
            document.getElementById('i-rng').innerText = Math.floor(s.r);
            document.getElementById('i-spd').innerText = (60/s.cd).toFixed(1);
            
            let cost = Math.floor(def.cost * 0.6 * (s.lvl+1));
            document.getElementById('i-up-cost').innerText = '$'+cost;
            document.getElementById('i-sell-cost').innerText = '$'+Math.floor(cost*0.5);
        },

        showHelp: () => {
            const m = document.getElementById('help-modal');
            const l = document.getElementById('help-list');
            const t = document.getElementById('help-title');
            m.style.display = 'block';
            l.innerHTML = '';
            
            if(Engine.game === VectorGame) {
                t.innerText = "VECTOR VALLEY GUIDE";
                l.innerHTML += `<li><b>Objective:</b> Enemies follow the orange rail. Don't let them reach the end.</li>`;
                l.innerHTML += `<li><b>Strategy:</b> Place turrets along the curves. Snipers are best for long straightaways.</li>`;
                l.innerHTML += `<li><b>Shields:</b> Blue enemies have shields. Use 'Rapid' turrets to break them.</li>`;
            } else if(Engine.game === NeonGame) {
                t.innerText = "NEON CITADEL GUIDE";
                l.innerHTML += `<li><b>Objective:</b> Build your own maze. Enemies will find the shortest path.</li>`;
                l.innerHTML += `<li><b>Mazing:</b> Use cheap towers to force enemies to walk back and forth.</li>`;
                l.innerHTML += `<li><b>Combos:</b> Place 'Booster' nodes near Snipers for massive damage.</li>`;
            } else {
                t.innerText = "SENTINEL GRID GUIDE";
                l.innerHTML += `<li><b>Objective:</b> Classic Grid Defense. Balance your economy.</li>`;
                l.innerHTML += `<li><b>Towers:</b> Blasters are good early game. Upgrade them before buying expensive units.</li>`;
            }
        }
    };

    // Canvas Inputs
    document.getElementById('c').onclick = (e) => {
        if(!Engine.game) return;
        let r = document.getElementById('c').getBoundingClientRect();
        Engine.game.click(e.clientX - r.left, e.clientY - r.top);
        Engine.updateInsp();
        // Sync Buttons
        document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active'));
        if(Engine.game.build) document.getElementById('btn-'+Engine.game.build).classList.add('active');
    }
    </script>
</body>
</html>
